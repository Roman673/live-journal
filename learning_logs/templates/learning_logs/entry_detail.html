{% extends 'base.html' %}
{% load bootstrap3 %}
{% load staticfiles %}

{% block title %}{{ entry }}{% endblock %}

{% block content %}
  {% if entry.image %}
    <img src="{{ entry.image.url }}" alt="{{ entry.title }}" class="img-thumbnail" height='150'>
  {% endif %}
  <h1>
    {{ entry|title }}
    {% if user == entry.owner %}
      <a href="{% url 'learning_logs:entry_update' entry.slug %}" class="btn btn-default"><span class="glyphicon glyphicon-edit"></span></a>
      <a href="{% url 'learning_logs:entry_delete' entry.slug %}" class="btn btn-default"><span class="glyphicon glyphicon-trash"></span></a>
    {% endif %}
    <div>
      <small>
        <span class="glyphicon glyphicon-eye-open"></span> {{ entry.views }}
        <span class="glyphicon glyphicon-pencil"></span> {{ entry.comment_set.all.count }}
        {% for tag in entry.tag.all %}
          <span class="label label-{{ tag.color }}">{{ tag.title }}</span>
        {% endfor %}
      </small>
    </div>
  </h1>
  <div class="media">
    <div class="media-left">
      {% if entry.owner.person.image %}
        <img src="{{ entry.owner.person.image.url }}" class="media-object img-circle" height='80px' width="80px">
      {% else %}
        <img src="{% static 'img/avatar-tiny.jpg' %}" class="media-object img-circle" heigth="64">
      {% endif %}
    </div>
    <div class="media-body">
      <div class="media-heading">
        <h4>
          {{ entry.owner|title }}
          <div>
            <small><i>Pablished on {{ entry.date_added|date:'M d, Y' }}</i></small>
          </div>
        </h4>
      </div>
    </div>
  </div>
  <br>
  <p class="text-justify">{{ entry.text|linebreaksbr }}</p>
  <br>
  
  <h4>Comments:</h4>
  

  {% for comment in entry.comment_set.all %}
    <div class="media">
      <div class="media-left">
        {% if comment.owner.person.image %}
          <img src="{{ comment.owner.person.image.url }}" class="media-object img-circle" height='60px' width="60px">
        {% else %}
          <img src="{% static 'img/avatar-tiny.jpg' %}" class="media-object img-circle">
        {% endif %}
      </div>
      <div class="media-body">
        <h4 class="media-heding">
          {{ comment.owner|title }}
          <small><i>Pablished on {{ comment.date_added|date:'M d, Y' }}</i></small>
          {% if comment.owner == user %}
            &nbsp;<a href="{% url 'learning_logs:comment_update' comment.pk %}" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-edit"></span></a>
            <a href="{% url 'learning_logs:comment_delete' comment.pk %}" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-trash"></span></a>
          {% endif %}
        </h4>
        <p>{{ comment.text|linebreaks }}</p>
      </div>
    </div>
  {% empty %}
    <div class="panel panel-default">
      <div class="panel-heading">No comments this entry yet.</div>
    </div>
  {% endfor %}

  <!-- Add new comments -->
  {% if user.is_authenticated %}
    <hr>
    <div class="row">
      <div class="col-md-6">
        <form action="{% url 'learning_logs:comment_create' entry.slug %}" method="post" class="form">
          {% csrf_token %}
          {% bootstrap_form form %}
          <input type="submit" class="btn btn-success" value="Add comment">
        </form>

      </div>
    </div>
    

  {% endif %}

{% endblock %}
